{% extends 'base.html' %}
{% load static %}

{% block content %}
    <div class="container bg-container-dark text-light">
        <div class="row">
            <div class="col-12 col-md-10 text-center text-md-left my-1">
                <h2><strong>Build-a-Bundle</strong>&trade;</h2>
                <p>Follow the steps below to build your bundle!</p>
            </div>
        </div>
        <hr class="bg-light">
        <div class="row my-2">
            <div class="col-10 offset-1">
                <form action="{% url 'bundles' %}" method="POST" id="selector-form">
                    {% csrf_token %}
                    <div class="row my-auto align-items-center">
                        <div class="col-md-4 offset-md-4 text-center">
                            {{ selector_form.categories|as_crispy_field }}
                        </div>
                    </div>
                    <div class="row my-auto align-items-center">
                        <div class="col-md-4 offset-md-4 text-center">
                            {{ selector_form.age|as_crispy_field }}
                        </div>
                    </div>
                    <button type="submit" class="d-none"></button>
                </form>
            </div>
        </div> 
        <hr class="bg-light">  
        <div class="row my-2">
            <div class="col-10 offset-1">
                {% if bundles %}
                    <p class="text-center">Step 2. Select your bundle below</p>
                {% endif %}
                <div class="row">
                    {% for bundle in bundles %}
                        {% include './includes/card.html' with result=bundle %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block postloadjs %}
{{ block.super }}
<script>    
    $(document).ready(function(){
        $('#div_id_age').toggle(
            $('select[name="categories"] option:selected').text().toLowerCase() == 'birthday')
        
        $('select[name="categories"]').on('change', function(e)  {         
            if($(this).find(":selected").text().toLowerCase() != 'birthday'){
                $('#selector-form').find('button').first().trigger('click');
            } else {
                $('#div_id_age').toggle($(this).find(":selected").text().toLowerCase() == 'birthday')
            }
        });

        $('select[name="age"]').on('change', function(e)  {         
            $('#selector-form').find('button').first().trigger('click');
        });
    });
</script>
{% endblock %}